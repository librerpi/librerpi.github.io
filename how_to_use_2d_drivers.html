<!DOCTYPE html>

<html>
<head>
<title>The librerpi project</title>
<link rel="stylesheet" href="1337box/1337box.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
</head>

<body>
<div class="Nav">
<h1>The librerpi project</h1>
<ul class="NavLinks">
<li class="NavLink"><a href="https://github.com/librerpi/lk-overlay">Main git repository</a></li>
<li class="NavLink"><a href="https://github.com/librerpi/librerpi.github.io">Edit the website</a></li>
<li class="NavLink"><a href="https://libera.irclog.whitequark.org/~h~raspberrypi-internals">IRC logs</a></li>
<li class="NavLink"><a href="https://hydra.angeldsis.com/jobset/things/littlekernel-overlay#tabs-jobs">CI builds</a></li>
</ul>
</div>
<details class="winList">
<summary>List of pages</summary>
<ul class="list">
<li class="winListClose"><button  onclick="document.querySelector('.winList') .removeAttribute('open')">Close</button></li>
<li><h3 style="margin: 5px;">Page list</h3></li>
<li><a href="/index.html">Home</a></li>
<li><a href="/compile.html">Compile/Install librerpi</a></li>
<li><a href="/contribute.html">Contributions</a></li>
<li><a href="/how_it_works.html">How the free and nonfree firmware work</a></li>
<li><a href="/how_to_use_2d_drivers.html">How to use 2D drivers</a></li>
</ul>
</details>
<div class="content">
<h1 id="How to use 2D drivers">How to use 2D drivers</h1>

<p>Here are demos using 2D drivers:</p>

<ul>
<li>https://www.youtube.com/watch?v=suswjbpR1HU</li>
<li>https://www.youtube.com/watch?v=JFmCin3EJIs</li>
</ul>

<p>The first video is a scaling test (source coming soon), 
and the second video is a demo of moving a lot of sprites 
around at once.</p>

<ul>
<li>https://github.com/librerpi/lk-overlay/blob/master/app/grid/grid.c</li>
</ul>

<p>In this file, <code>gfx_create_surface()</code> will create a bitmap image in ram.</p>

<p>Lines 18-29:</p>

<pre><code>  for (int x=0; x&lt; width; x++) {
    for (int y=0; y &lt; height; y++) {
      uint color = 0x00000000;
      if (true) {
        if (y % grid == 0) color |= 0xffff0000;
        if (y % grid == 1) color |= 0xffff0000;
        if (x % grid == 0) color |= 0xff0000ff;
        if (x % grid == 1) color |= 0xff0000ff;
      }
      gfx_putpixel(gfx_grid, x, y, color);
    }
  }
</code></pre>

<p>Those lines will render a grid into it (there's also the 
ability to load tga image files).</p>

<p>Lines 31-35:</p>

<pre><code>  grid_layer = malloc(sizeof(hvs_layer));
  mk_unity_layer(grid_layer, gfx_grid, 60, 100, 100);
  grid_layer-&gt;name = "grid";
  grid_layer-&gt;w = 100;
  grid_layer-&gt;h = 300;
</code></pre>

<p>Those lines will create a sprite description.</p>

<p>Lines 37-40:</p>

<pre><code>  mutex_acquire(&amp;channels[channel].lock);
  hvs_dlist_add(channel, grid_layer);
  hvs_update_dlist(channel);
  mutex_release(&amp;channels[channel].lock);
}
</code></pre>

<p>Those lines will make that sprite visible, and 
will schedule a pageflip on the next vsync.</p>

<p>Line 53:</p>

<pre><code>    hvs_wait_vsync(channel);
</code></pre>

<p>will wait for vsync to happen.</p>

<p>Lines 55-72:</p>

<pre><code>    {
      if (grow_w &amp;&amp; (grid_layer-&gt;w &gt;= 300)) grow_w = false;
      if (!grow_w &amp;&amp; (grid_layer-&gt;w &lt;= 5)) grow_w = true;

      int delta = 1;
      if (!grow_w) delta = -1;

      grid_layer-&gt;w += delta;
    }
    {
      if (grow_h &amp;&amp; (grid_layer-&gt;h &gt;= 300)) grow_h = false;
      if (!grow_h &amp;&amp; (grid_layer-&gt;h &lt;= 5)) grow_h = true;

      int delta = 1;
      if (!grow_h) delta = -1;

      grid_layer-&gt;h += delta;
    }
</code></pre>

<p>These lines change the sprite size.</p>

<p>And finally, line 75:</p>

<pre><code>    hvs_update_dlist(channel);
</code></pre>

<p>This line schedules another pageflip on vsync.</p>

<p>With all that code, and some GPIO reading, you 
can make a 2D demo or game, and this basically 
uses 0% of the cpu, instead, it uses the gpu, 
and has absolutely no screen tearing.</p>
</div>
<hr/>
<footer>All the pages are licensed under the GPL-3.0+ license unless stated otherwise.</footer>
</body>
<style>
body
{
	background-color: white;
	color: #222;
	font-size: 12pt;
	margin-bottom: 5px;
}

.content
{
	max-width: 130ch;
	margin: 0 auto;

}

.winList li.winListClose
{
	float: right;
}

.winList li.winListClose button
{
	border: none;
	background: #333;
	color: white;
	padding: 5px;
	cursor: pointer;
}

.winList summary
{
	width: fit-content;
	margin: 0 5em;
	list-style: none;
	padding: 5px;
	background: #222;
	color: white;
	cursor: pointer;
}

.list
{
	position: fixed;
	top: 30%;
	left: 35%;
	right: 35%;
	background: #222;
	padding: 10px 10px;
	color: white;
	list-style: none;
	box-shadow: 0px 0px 100px black;
}

.list a
{
	display: block;
	text-decoration: none;
	color: white;
	padding: 5px 5px;
}

.list a:hover
{
	background: #333
}

img
{
	width: 60%;
}

hr
{
	border: none;
	border: 3px solid #222;
}

table
{
	border-collapse: collapse;
}

table thead th
{
	padding: 10px;
	background: #222;
	color: white;
}

table td, table th, table tr
{
	border: 1px solid #222;
	padding: 6px;
}

.t_red
{
	background: orangered;
}

.t_green
{
	background: lightgreen;
}

.t_orange
{
	background: orange;
}

img
{
	padding: 20px;
}

.content h1, .content h2, .content h3, 
.content h4, .content h5
{
	border-left: 10px solid #222;
	padding: 0 5px;
	margin: 0;
}

h1:target, h2:target, h3:target, h4:target, h5:target
{
	background: #222;
	color: white;
}

.NavLinks
{
	margin-top: 1vh;
	padding: 20px;
	display: flex;
	text-align: center;
	list-style: none;
}

.Nav
{
	background: url("img/banner.jpg");
	background-position: 0 center;
	background-size: 100%;
	background-repeat: no-repeat;
	padding: 5px 10em;
}

.Nav h1
{
	color: white;
	text-shadow: 1px 1px 10px black;
}

.NavLink a
{
	color:black;
	text-decoration: none;
	background-color: white;
	color: black;
	margin: 0px;
	padding: 10px;

}

.NavLink
{
	margin: 10px;
}

.NavLink a:hover
{
	background-color: black;
	color: white;
}

pre
{
	overflow: auto;
	background-color: whitesmoke;
	color: black;
	padding: 5px;
}
</style>
</html>
<code>
HEAD: bad8730d446538e8d85bf7587c2958e0c81fb29b
</code>
